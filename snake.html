<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Snake - Arcade Edition</title>
    <link href="[https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap](https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap)" rel="stylesheet">
    <link rel="stylesheet" href="snake.css">
</head>
<body>
    <div class="game-wrapper">
        <div class="header">
            <span>Score: <span id="score">0</span></span>
            <span>High Score: <span id="high-score">0</span></span>
        </div>
        
        <div id="game-area">
            <canvas id="game-board"></canvas>
            <div id="start-screen" class="overlay">
                <h2>Snake</h2>
                <button id="start-game-btn">Start Game</button>
            </div>
            <div id="game-over-screen" class="overlay hidden">
                <h2>GAME OVER</h2>
                <p>Final Score: <span id="final-score">0</span></p>
                <button id="play-again-btn">Play Again</button>
            </div>
        </div>

        <div id="mobile-controls" class="hidden">
            <div class="d-pad">
                <button id="up-btn" class="ctrl-btn">⬆️</button>
                <button id="left-btn" class="ctrl-btn">⬅️</button>
                <button id="right-btn" class="ctrl-btn">➡️</button>
                <button id="down-btn" class="ctrl-btn">⬇️</button>
            </div>
        </div>
    </div>
    <div class="footer-nav">
        <a href="index.html" class="back-btn">&lt; Back to Arcade</a>
        <button id="theme-toggle">Dark Mode</button>
        <span>Snake Beta v0.1</span>
    </div>
    <script>
        const canvas = document.getElementById('game-board'), ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score'), highScoreEl = document.getElementById('high-score');
        const startScreen = document.getElementById('start-screen'), gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreEl = document.getElementById('final-score'), startGameBtn = document.getElementById('start-game-btn'), playAgainBtn = document.getElementById('play-again-btn');
        const mobileControls = document.getElementById('mobile-controls');

        const gridSize = 20;
        let tileCount;

        function setCanvasSize() {
            let size = Math.min(window.innerWidth - 40, window.innerHeight - 250, 500);
            tileCount = Math.floor(size / gridSize);
            canvas.width = canvas.height = tileCount * gridSize;
        }

        const gameState = { snake: [], food: {}, direction: { x: 1, y: 0 }, nextDirection: { x: 1, y: 0 }, score: 0, status: 'PRE-GAME', gameLoop: null };
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        highScoreEl.textContent = highScore;

        function getThemeColor(cssVar) { return getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim(); }

        function resetGame() {
            if (gameState.gameLoop) clearInterval(gameState.gameLoop);
            gameState.snake = [{ x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) }];
            gameState.direction = { x: 1, y: 0 }; gameState.nextDirection = { x: 1, y: 0 };
            gameState.score = 0; scoreEl.textContent = 0;
            placeFood();
        }

        function startGame() {
            resetGame();
            gameState.status = 'PLAYING';
            startScreen.classList.add('hidden'); gameOverScreen.classList.add('hidden');
            canvas.style.display = 'block';
            gameState.gameLoop = setInterval(tick, 100);
        }

        function placeFood() {
            let newFood;
            do { newFood = { x: Math.floor(Math.random() * tileCount), y: Math.floor(Math.random() * tileCount) }; } 
            while (gameState.snake.some(s => s.x === newFood.x && s.y === newFood.y));
            gameState.food = newFood;
        }

        function tick() {
            if (gameState.status !== 'PLAYING') return;
            const isOpposite = (d1, d2) => d1.x === -d2.x && d1.x !== 0 || d1.y === -d2.y && d1.y !== 0;
            if (!isOpposite(gameState.nextDirection, gameState.direction)) { gameState.direction = { ...gameState.nextDirection }; }
            const head = { x: gameState.snake[0].x + gameState.direction.x, y: gameState.snake[0].y + gameState.direction.y };
            const wallCollision = head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount;
            const selfCollision = gameState.snake.slice(1).some(s => s.x === head.x && s.y === head.y);
            if (wallCollision || selfCollision) {
                gameState.status = 'GAME-OVER'; clearInterval(gameState.gameLoop);
                finalScoreEl.textContent = gameState.score;
                if (gameState.score > highScore) { highScore = gameState.score; localStorage.setItem('snakeHighScore', highScore); highScoreEl.textContent = highScore; }
                gameOverScreen.classList.remove('hidden'); return;
            }
            gameState.snake.unshift(head);
            if (head.x === gameState.food.x && head.y === gameState.food.y) { gameState.score++; scoreEl.textContent = gameState.score; placeFood(); } else { gameState.snake.pop(); }
            draw();
        }

        function draw() {
            ctx.fillStyle = getThemeColor('--game-bg');
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = getThemeColor('--food-color');
            ctx.fillRect(gameState.food.x * gridSize, gameState.food.y * gridSize, gridSize - 1, gridSize - 1);
            gameState.snake.forEach((segment, index) => {
                ctx.fillStyle = getThemeColor(index === 0 ? '--snake-head-color' : '--snake-body-color');
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 1, gridSize - 1);
            });
        }

        function handleDirectionChange(newDir) { if (gameState.status === 'PLAYING') { gameState.nextDirection = newDir; } }
        
        // --- Event Listeners ---
        window.addEventListener('keydown', (e) => {
            e.preventDefault();
            switch(e.key.toLowerCase()) {
                case 'w': case 'arrowup': handleDirectionChange({ x: 0, y: -1 }); break;
                case 's': case 'arrowdown': handleDirectionChange({ x: 0, y: 1 }); break;
                case 'a': case 'arrowleft': handleDirectionChange({ x: -1, y: 0 }); break;
                case 'd': case 'arrowright': handleDirectionChange({ x: 1, y: 0 }); break;
            }
        });
        startGameBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', startGame);
        window.addEventListener('resize', () => { setCanvasSize(); draw(); });

        // --- Mobile & Theme Setup ---
        const isMobile = 'ontouchstart' in window;
        if (isMobile) { mobileControls.classList.remove('hidden'); }
        document.getElementById('up-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleDirectionChange({ x: 0, y: -1 }); });
        document.getElementById('down-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleDirectionChange({ x: 0, y: 1 }); });
        document.getElementById('left-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleDirectionChange({ x: -1, y: 0 }); });
        document.getElementById('right-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleDirectionChange({ x: 1, y: 0 }); });

        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        function applyTheme() {
            const isDark = localStorage.getItem('theme') === 'dark';
            body.classList.toggle('dark-mode', isDark);
            themeToggle.textContent = isDark ? 'Light Mode' : 'Dark Mode';
            draw();
        }
        themeToggle.addEventListener('click', () => {
            const isDark = !body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            applyTheme();
        });

        // --- Initialisation ---
        setCanvasSize();
        resetGame();
        applyTheme();
        startScreen.classList.remove('hidden');
        canvas.style.display = 'block';
    </script>
</body>
</html>